

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial v1.x &mdash; Sophos.Sophos_Firewall  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=41de9001" />
      <link rel="stylesheet" type="text/css" href="../_static/css/ansible.css?v=c5b67dd2" />
      <link rel="stylesheet" type="text/css" href="../_static/antsibull-minimal.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/rtd-ethical-ads.css?v=289b023e" />

  
    <link rel="shortcut icon" href="../_static/images/Ansible-Mark-RGB_Black.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=7f41d439"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="sophos.sophos_firewall.sfos_admin_settings module – Manage Admin and user settings (System &gt; Administration)" href="../sfos_admin_settings_module.html" />
    <link rel="prev" title="Tutorial v2.x" href="tutorial2.x.html" /><!-- extra head elements for Ansible beyond RTD Sphinx Theme -->




</head>

<body class="wy-body-for-nav"><!-- extra body elements for Ansible beyond RTD Sphinx Theme -->

<div class="DocSite-globalNav ansibleNav">
  <ul>
    <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
    <li><a href="https://forum.ansible.com/" target="_blank">Ansible community forum</a></li>
    <li><a href="https://docs.ansible.com/" target="_blank">Documentation</a></li>
  </ul>
</div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/Ansible-Mark-RGB_White.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">Sophos Firewall Ansible Collection</div>
</a>
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Sophos.Sophos_Firewall
          </a><!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    
  
</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <label class="sr-only" for="q">Search docs:</label>
    <input type="text" class="st-default-search-input" id="q" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Sophos.Sophos_Firewall Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="httpapi_example.html">New in version 2.0: HttpApi Plugin</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Required Firewall Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial2.x.html">Tutorial v2.x</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial v1.x</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sfos_admin_settings_module.html">sophos.sophos_firewall.sfos_admin_settings module – Manage Admin and user settings (System &gt; Administration)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_atp_module.html">sophos.sophos_firewall.sfos_atp module – Manage Active Threat Protection (Protect &gt; Active threat response &gt; Sophos X-Ops threat feeds)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_authentication_ad_module.html">sophos.sophos_firewall.sfos_authentication_ad module – Manage Authentication settings Active Directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_authentication_azure_module.html">sophos.sophos_firewall.sfos_authentication_azure module – Manage Authentication settings AzureADSSO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_authentication_edirectory_module.html">sophos.sophos_firewall.sfos_authentication_edirectory module – Manage Authentication settings eDirectory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_authentication_ldap_module.html">sophos.sophos_firewall.sfos_authentication_ldap module – Manage Authentication settings LDAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_authentication_radius_module.html">sophos.sophos_firewall.sfos_authentication_radius module – Manage Authentication settings Radius</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_authentication_tacacs_module.html">sophos.sophos_firewall.sfos_authentication_tacacs module – Manage Authentication settings Tacacs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_backup_module.html">sophos.sophos_firewall.sfos_backup module – Manage Backup settings (System &gt; Backup &amp; firmware)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_certificate_module.html">sophos.sophos_firewall.sfos_certificate module – Manage Certificates (System &gt; Certificates)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_certificate_authority_module.html">sophos.sophos_firewall.sfos_certificate_authority module – Manage Certificate Authorities (System &gt; Certificates &gt; Certificate Authorities)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_device_access_profile_module.html">sophos.sophos_firewall.sfos_device_access_profile module – Manage Device Access Profiles (System &gt; Profiles &gt; Device Access)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_dns_module.html">sophos.sophos_firewall.sfos_dns module – Manage DNS settings (Configure &gt; Network &gt; DNS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_firewall_rule_module.html">sophos.sophos_firewall.sfos_firewall_rule module – Manage Firewall Rules (Protect &gt; Rules &amp; policies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_firewall_rulegroup_module.html">sophos.sophos_firewall.sfos_firewall_rulegroup module – Manage Firewall Rules (Protect &gt; Rules &amp; policies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_fqdn_host_module.html">sophos.sophos_firewall.sfos_fqdn_host module – Manage FQDN hosts (System &gt; Hosts &amp; services &gt; FQDN host)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_fqdn_hostgroup_module.html">sophos.sophos_firewall.sfos_fqdn_hostgroup module – Manage FQDN Host Groups (System &gt; Hosts &amp; services &gt; FQDN host group)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_ip_host_module.html">sophos.sophos_firewall.sfos_ip_host module – Manage IP Host (System &gt; Hosts &amp; services &gt; IP host)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_ip_hostgroup_module.html">sophos.sophos_firewall.sfos_ip_hostgroup module – Manage IP Hostgroup (System &gt; Hosts &amp; services &gt; IP host group)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_ips_module.html">sophos.sophos_firewall.sfos_ips module – Manage IPS protection (Protect &gt; Intrusion Protection &gt; IPS policies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_ipsec_connection_module.html">sophos.sophos_firewall.sfos_ipsec_connection module – Manage IPSec Connection (Configure &gt; Site-to-site VPN &gt; IPSec)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_malware_protection_module.html">sophos.sophos_firewall.sfos_malware_protection module – Manage Malware Protection (Configure &gt; System services &gt; Malware protection)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_netflow_module.html">sophos.sophos_firewall.sfos_netflow module – Manage NetFlow configuration (System &gt; Administration &gt; NetFlow)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_notification_target_module.html">sophos.sophos_firewall.sfos_notification_target module – Manage Notification Settings (System &gt; Administration &gt; Notification)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_qos_policy_module.html">sophos.sophos_firewall.sfos_qos_policy module – Manage QoS Policies (Configure &gt; System Services &gt; Traffic Shaping)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_service_module.html">sophos.sophos_firewall.sfos_service module – Manage Service (System &gt; Hosts and services &gt; Services)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_service_acl_exception_module.html">sophos.sophos_firewall.sfos_service_acl_exception module – Manage Local Service Exception ACL Rules (System &gt; Administration &gt; Device Access)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_servicegroup_module.html">sophos.sophos_firewall.sfos_servicegroup module – Manage Service Group (System &gt; Hosts and services &gt; Service Group)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_snmp_agent_module.html">sophos.sophos_firewall.sfos_snmp_agent module – Manage SNMP Agent (System &gt; Administration &gt; SNMP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_snmp_user_module.html">sophos.sophos_firewall.sfos_snmp_user module – Manage SNMPv3 User (System &gt; Administration &gt; SNMP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_syslog_module.html">sophos.sophos_firewall.sfos_syslog module – Manage Syslog servers (Configure &gt; System services &gt; Log settings)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_time_module.html">sophos.sophos_firewall.sfos_time module – Manage Date and Time settings (System &gt; Administration &gt; Time)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_urlgroup_module.html">sophos.sophos_firewall.sfos_urlgroup module – Manage URL Groups on Sophos Firewall</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_user_module.html">sophos.sophos_firewall.sfos_user module – Manage Users (Configure &gt; Authentication &gt; Users)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_web_category_module.html">sophos.sophos_firewall.sfos_web_category module – Manage Web Categories (Protect &gt; Web &gt; Web Categories)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_web_filetype_module.html">sophos.sophos_firewall.sfos_web_filetype module – Manage Web File Types (Protect &gt; Web &gt; File Types)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_web_policy_module.html">sophos.sophos_firewall.sfos_web_policy module – Manage Web Filter Policies (Protect &gt; Web &gt; Policies)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_web_useractivity_module.html">sophos.sophos_firewall.sfos_web_useractivity module – Manage Web User Activities (Protect &gt; Web &gt; User Activities)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_xmlapi_module.html">sophos.sophos_firewall.sfos_xmlapi module – Use the XML API to get, create, update, or delete settings on Sophos Firewall.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sfos_zone_module.html">sophos.sophos_firewall.sfos_zone module – Manage Zones (Configure &gt; Network &gt; Zones)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../sfos_httpapi.html">sophos.sophos_firewall.sfos httpapi – HttpApi plugin for Sophos Firewall (SFOS)</a></li>
</ul>
<!-- extra nav elements for Ansible beyond RTD Sphinx Theme -->

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sophos.Sophos_Firewall</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorial v1.x</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

  
           <div itemprop="articleBody">
             
  <div class="admonition note" id="ansible-collections-sophos-sophos-firewall-docsite-usage">
<p class="admonition-title">Note</p>
<p>This tutorial uses the syntax required prior to the changes in version 2.0. Please see the <a class="reference external" href="https://sophosfirewall-ansible.readthedocs.io/en/latest/docsite/httpapi_example.html">HTTPAPI Plugin example</a> for details.</p>
</div>
<section id="tutorial-v1-x">
<h1>Tutorial v1.x<a class="headerlink" href="#tutorial-v1-x" title="Link to this heading"></a></h1>
<p>This section is intended to help users who may be new to Ansible get up and running with their first playbook using the Sophos Firewall Ansible Collection.
Experienced Ansible users may want to skip this section and review the documentation for the individual <a class="reference external" href="../index.html#modules">modules</a>.</p>
<p>Ansible requires two main components to operate; an <a class="reference external" href="https://docs.ansible.com/ansible/latest/inventory_guide/index.html">inventory</a>
and a <a class="reference external" href="https://docs.ansible.com/ansible/latest/playbook_guide/index.html">playbook</a>. An inventory file specifies what firewall(s) the Ansible playbook should operate on. It can also include variable
definitions that can be referenced in the playbook.</p>
<p>Below is a simple inventory file containing a single firewall with
variable definitions for the HTTPS port and certificate verification setting. The <code class="docutils literal notranslate"><span class="pre">verify:</span> <span class="pre">false</span></code> setting turns off
certificate checking. This should be set to <strong>true</strong> if the firewall has a valid SSL certificate installed.
The <code class="docutils literal notranslate"><span class="pre">ansible_connection:</span> <span class="pre">local</span></code> setting is also needed because by default Ansible will try to connect to the inventory items using SSH. This setting disables
that behavior. The modules will instead be connecting to the firewall(s) using the XML API over HTTPS.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># inventory.yml</span>
<span class="nt">testfirewall</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">testfirewall.sophos.com</span><span class="p">:</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4444</span>
<span class="w">      </span><span class="nt">verify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">ansible_connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</pre></div>
</div>
<p>A playbook file contains tasks that will be executed against the firewall(s) in the inventory file. At the top of the file, the
inventory group is specified. In this case, <strong>all</strong> is used to specify operation on all hosts in the inventory.
The <code class="docutils literal notranslate"><span class="pre">gather_facts:</span> <span class="pre">false</span></code> command disables Ansible from gathering details about the system that it is working on because it is not
necessary for this collection and would make the playbook run more slowly.</p>
<p>In the <strong>tasks</strong> section of the playbook, a module is referenced using the format <strong>{namespace}.{collection}.{module}</strong>. In the below example, the module
<code class="docutils literal notranslate"><span class="pre">sophos.sophos_firewall.sfos_ip_host</span></code> will be used to create an IP Host on Sophos firewall.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SOPHOS FIREWALL ANSIBLE PLAYBOOK</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ADD IP HOST</span>
<span class="w">      </span><span class="nt">sophos.sophos_firewall.sfos_ip_host</span><span class="p">:</span>
<span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">username</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">verify</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">verify</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testhost1</span>
<span class="w">        </span><span class="nt">ip_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.1.1.1</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</pre></div>
</div>
<p>In the above task, underneath the module are the arguments
needed to connect to the firewall and the parameters for configuring the IP Host. Each module will always have these
common arguments:</p>
<blockquote>
<div><ul class="simple">
<li><p>username</p></li>
<li><p>password</p></li>
<li><p>hostname</p></li>
<li><p>port</p></li>
<li><p>verify</p></li>
<li><p>state</p></li>
</ul>
</div></blockquote>
<p>In addition, there will be arguments that are specific to the module, such as <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">ip_address</span></code> in the above example.
Refer to the individual <a class="reference external" href="../index.html#modules">module</a> documentation for the available arguments for each module.
The <code class="docutils literal notranslate"><span class="pre">state</span></code> argument indicates the operation to be performed. Modules support the following values for the <code class="docutils literal notranslate"><span class="pre">state</span></code> argument:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>present</strong>: Create if not existing</p></li>
<li><p><strong>absent</strong>: Delete if exists</p></li>
<li><p><strong>updated</strong>: Update existing</p></li>
<li><p><strong>query</strong>: Retrieve the existing</p></li>
</ul>
</div></blockquote>
<p>The strings enclosed within double curly brackets, such as <code class="docutils literal notranslate"><span class="pre">&quot;{{</span> <span class="pre">username</span> <span class="pre">}}&quot;</span></code> in the example, are references to <a class="reference external" href="https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html">variables</a>. Variables can be set in multiple locations
in Ansible. In this case we are pulling in the <code class="docutils literal notranslate"><span class="pre">port</span></code> and <code class="docutils literal notranslate"><span class="pre">verify</span></code> variables from the inventory file.  The variable <code class="docutils literal notranslate"><span class="pre">inventory_hostname</span></code>
is a special variable that is available by default in Ansible to refer to the current hostname being worked on from the inventory file.</p>
<p>The username and password arguments require special consideration to ensure the credentials are stored securely. While the credentials could be entered
directly as inventory variables or directly in the tasks in the playbook, doing so is highly discouraged because these files are often eventually
checked into a source control repository such as Github where they can be easily read by anyone. There are many options to
supply credentials securely to Ansible. One of the built-in options is using <a class="reference external" href="https://docs.ansible.com/ansible/latest/vault_guide/index.html">Ansible Vault</a>. Ansible Vault can be used to encrypt the credentials in a file, and decrypt
the file at run time to retrieve the variables.  Other options include using a secrets manager, such as <a class="reference external" href="https://docs.ansible.com/ansible/latest/collections/index_module.html#community-hashi-vault">Hashicorp Vault</a>.
For this guide, we’ll use Ansible Vault.</p>
<p>First, create a YAML file containing the username and password variables.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># credentials.yml</span>
<span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your firewall username&gt;</span>
<span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your firewall password&gt;</span>
</pre></div>
</div>
<p>Create a directory <code class="docutils literal notranslate"><span class="pre">group_vars</span></code> and within that a subdirectory <code class="docutils literal notranslate"><span class="pre">all</span></code>. Save the file as <code class="docutils literal notranslate"><span class="pre">group_vars/all/credentials.yml</span></code>. Next, use the <code class="docutils literal notranslate"><span class="pre">ansible-vault</span></code> command to encrypt the file with AES 256-bit encryption:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ansible-vault<span class="w"> </span>encrypt<span class="w"> </span>group_vars/all/credentials.yml
</pre></div>
</div>
<p>The above command will prompt for creation of an encryption password. This password will be entered at the command line to decrypt the credentials when running the playbook.</p>
<p>To run the playbook, use the <code class="docutils literal notranslate"><span class="pre">ansible-playbook</span></code> command as shown below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>playbook.yml<span class="w"> </span>--ask-vault-pass<span class="w"> </span>-v
</pre></div>
</div>
<p>When prompted, enter the encryption password created when executing the <code class="docutils literal notranslate"><span class="pre">ansible-vault</span></code> command above. Output should look similar to the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>test.yml<span class="w"> </span>--ask-vault-pass<span class="w"> </span>-v
No<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span>found<span class="p">;</span><span class="w"> </span>using<span class="w"> </span>defaults
Vault<span class="w"> </span>password:

PLAY<span class="w"> </span><span class="o">[</span>SOPHOS<span class="w"> </span>FIREWALL<span class="w"> </span>ANSIBLE<span class="w"> </span>PLAYBOOK<span class="o">]</span><span class="w"> </span>*********************************************************************************************************

TASK<span class="w"> </span><span class="o">[</span>ADD<span class="w"> </span>IP<span class="w"> </span>HOST<span class="o">]</span><span class="w"> </span>************************************************************************************************************************************
changed:<span class="w"> </span><span class="o">[</span>testfirewall.sophos.com<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span><span class="s2">&quot;api_response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;Response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@APIVersion&quot;</span>:<span class="w"> </span><span class="s2">&quot;2000.2&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IPS_CAT_VER&quot;</span>:<span class="w"> </span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IS_WIFI6&quot;</span>:<span class="w"> </span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPHost&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@transactionid&quot;</span>:<span class="w"> </span><span class="s2">&quot;&quot;</span>,<span class="w"> </span><span class="s2">&quot;Status&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;#text&quot;</span>:<span class="w"> </span><span class="s2">&quot;Configuration applied successfully.&quot;</span>,<span class="w"> </span><span class="s2">&quot;@code&quot;</span>:<span class="w"> </span><span class="s2">&quot;200&quot;</span><span class="o">}}</span>,<span class="w"> </span><span class="s2">&quot;Login&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;Authentication Successful&quot;</span><span class="o">}}}</span>,<span class="w"> </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>true,<span class="w"> </span><span class="s2">&quot;check_mode&quot;</span>:<span class="w"> </span>false<span class="o">}</span>

PLAY<span class="w"> </span>RECAP<span class="w"> </span>********************************************************************************************************************************************
testfirewall.sophos.com<span class="w">              </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The modules in this collection are idempotent; they will not take any action if the configuration is already in the intended state.
Due to this, if you run the above task a second time, the response should indicate <code class="docutils literal notranslate"><span class="pre">changed=0</span></code>.</p>
</div>
<p>To check that the host was created, you can check in the firewall dashboard under System &gt; Hosts and services &gt; IP host. To check using an Ansible task,
change the <code class="docutils literal notranslate"><span class="pre">state</span></code> argument to <code class="docutils literal notranslate"><span class="pre">query</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SOPHOS FIREWALL ANSIBLE PLAYBOOK</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QUERY IP HOST</span>
<span class="w">      </span><span class="nt">sophos.sophos_firewall.sfos_ip_host</span><span class="p">:</span>
<span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">username</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">verify</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">verify</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testhost</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</pre></div>
</div>
<p>The output should be similar to the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>test.yml<span class="w"> </span>--ask-vault-pass<span class="w"> </span>-v
No<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span>found<span class="p">;</span><span class="w"> </span>using<span class="w"> </span>defaults
Vault<span class="w"> </span>password:

PLAY<span class="w"> </span><span class="o">[</span>SOPHOS<span class="w"> </span>FIREWALL<span class="w"> </span>ANSIBLE<span class="w"> </span>PLAYBOOK<span class="o">]</span><span class="w"> </span>*********************************************************************************************************

TASK<span class="w"> </span><span class="o">[</span>QUERY<span class="w"> </span>IP<span class="w"> </span>HOST<span class="o">]</span><span class="w"> </span>**********************************************************************************************************************************
ok:<span class="w"> </span><span class="o">[</span>testhost.sophos.com<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span><span class="s2">&quot;api_response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;Response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@APIVersion&quot;</span>:<span class="w"> </span><span class="s2">&quot;2000.2&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IPS_CAT_VER&quot;</span>:<span class="w"> </span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IS_WIFI6&quot;</span>:<span class="w"> </span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPHost&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@transactionid&quot;</span>:<span class="w"> </span><span class="s2">&quot;&quot;</span>,<span class="w"> </span><span class="s2">&quot;Description&quot;</span>:<span class="w"> </span>null,<span class="w"> </span><span class="s2">&quot;HostType&quot;</span>:<span class="w"> </span><span class="s2">&quot;IP&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPAddress&quot;</span>:<span class="w"> </span><span class="s2">&quot;1.1.1.1&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPFamily&quot;</span>:<span class="w"> </span><span class="s2">&quot;IPv4&quot;</span>,<span class="w"> </span><span class="s2">&quot;Name&quot;</span>:<span class="w"> </span><span class="s2">&quot;testhost&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;Login&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;Authentication Successful&quot;</span><span class="o">}}}</span>,<span class="w"> </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,<span class="w"> </span><span class="s2">&quot;check_mode&quot;</span>:<span class="w"> </span>false<span class="o">}</span>

PLAY<span class="w"> </span>RECAP<span class="w"> </span>********************************************************************************************************************************************
testhost.sophos.com<span class="w">              </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>To update the test host configuration, such as change the IP address, we can change the <code class="docutils literal notranslate"><span class="pre">ip_address</span></code> argument and set the
<code class="docutils literal notranslate"><span class="pre">state</span></code> field to <code class="docutils literal notranslate"><span class="pre">updated</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SOPHOS FIREWALL ANSIBLE PLAYBOOK</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UPDATE IP HOST</span>
<span class="w">      </span><span class="nt">sophos.sophos_firewall.sfos_ip_host</span><span class="p">:</span>
<span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">username</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">verify</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">verify</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testhost</span>
<span class="w">        </span><span class="nt">ip_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.2.2.2</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">updated</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>test.yml<span class="w"> </span>--ask-vault-pass<span class="w"> </span>-v
No<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span>found<span class="p">;</span><span class="w"> </span>using<span class="w"> </span>defaults
Vault<span class="w"> </span>password:

PLAY<span class="w"> </span><span class="o">[</span>SOPHOS<span class="w"> </span>FIREWALL<span class="w"> </span>ANSIBLE<span class="w"> </span>MODULE<span class="w"> </span>TESTING<span class="o">]</span><span class="w"> </span>*********************************************************************************************************

TASK<span class="w"> </span><span class="o">[</span>UPDATE<span class="w"> </span>IP<span class="w"> </span>HOST<span class="o">]</span><span class="w"> </span>*********************************************************************************************************************************
changed:<span class="w"> </span><span class="o">[</span>testhost.sophos.com<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span><span class="s2">&quot;api_response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;Response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@APIVersion&quot;</span>:<span class="w"> </span><span class="s2">&quot;2000.2&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IPS_CAT_VER&quot;</span>:<span class="w"> </span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IS_WIFI6&quot;</span>:<span class="w"> </span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPHost&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@transactionid&quot;</span>:<span class="w"> </span><span class="s2">&quot;&quot;</span>,<span class="w"> </span><span class="s2">&quot;Status&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;#text&quot;</span>:<span class="w"> </span><span class="s2">&quot;Configuration applied successfully.&quot;</span>,<span class="w"> </span><span class="s2">&quot;@code&quot;</span>:<span class="w"> </span><span class="s2">&quot;200&quot;</span><span class="o">}}</span>,<span class="w"> </span><span class="s2">&quot;Login&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;Authentication Successful&quot;</span><span class="o">}}}</span>,<span class="w"> </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>true,<span class="w"> </span><span class="s2">&quot;check_mode&quot;</span>:<span class="w"> </span>false<span class="o">}</span>

PLAY<span class="w"> </span>RECAP<span class="w"> </span>********************************************************************************************************************************************
testhost.sophos.com<span class="w">              </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>To see that the IP address has changed, we can change the state again to <code class="docutils literal notranslate"><span class="pre">query</span></code>, and this time register a variable to store the result using the <code class="docutils literal notranslate"><span class="pre">register</span></code> module argument.
Then a second task is added using the built-in debug module to display the ip address.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SOPHOS FIREWALL ANSIBLE PLAYBOOK</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">QUERY IP HOST</span>
<span class="w">      </span><span class="nt">sophos.sophos_firewall.sfos_ip_host</span><span class="p">:</span>
<span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">username</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">verify</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">verify</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testhost</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">      </span><span class="c1"># Added a variable called query_host to store the results of the task</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query_host</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DISPLAY IP ADDRESS</span>
<span class="w">      </span><span class="nt">ansible.builtin.debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">query_host.api_response.Response.IPHost.IPAddress</span>
</pre></div>
</div>
<p>The output should look similar to the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>test.yml<span class="w"> </span>--ask-vault-pass<span class="w"> </span>-v
No<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span>found<span class="p">;</span><span class="w"> </span>using<span class="w"> </span>defaults
Vault<span class="w"> </span>password:

PLAY<span class="w"> </span><span class="o">[</span>SOPHOS<span class="w"> </span>FIREWALL<span class="w"> </span>ANSIBLE<span class="w"> </span>PLAYBOOK<span class="o">]</span><span class="w"> </span>*********************************************************************************************************

TASK<span class="w"> </span><span class="o">[</span>UPDATE<span class="w"> </span>IP<span class="w"> </span>HOST<span class="o">]</span><span class="w"> </span>*********************************************************************************************************************************
ok:<span class="w"> </span><span class="o">[</span>testhost.sophos.com<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span><span class="s2">&quot;api_response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;Response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@APIVersion&quot;</span>:<span class="w"> </span><span class="s2">&quot;2000.2&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IPS_CAT_VER&quot;</span>:<span class="w"> </span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IS_WIFI6&quot;</span>:<span class="w"> </span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPHost&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@transactionid&quot;</span>:<span class="w"> </span><span class="s2">&quot;&quot;</span>,<span class="w"> </span><span class="s2">&quot;Description&quot;</span>:<span class="w"> </span>null,<span class="w"> </span><span class="s2">&quot;HostType&quot;</span>:<span class="w"> </span><span class="s2">&quot;IP&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPAddress&quot;</span>:<span class="w"> </span><span class="s2">&quot;2.2.2.2&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPFamily&quot;</span>:<span class="w"> </span><span class="s2">&quot;IPv4&quot;</span>,<span class="w"> </span><span class="s2">&quot;Name&quot;</span>:<span class="w"> </span><span class="s2">&quot;testhost&quot;</span><span class="o">}</span>,<span class="w"> </span><span class="s2">&quot;Login&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;Authentication Successful&quot;</span><span class="o">}}}</span>,<span class="w"> </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,<span class="w"> </span><span class="s2">&quot;check_mode&quot;</span>:<span class="w"> </span>false<span class="o">}</span>

TASK<span class="w"> </span><span class="o">[</span>DISPLAY<span class="w"> </span>IP<span class="w"> </span>ADDRESS<span class="o">]</span><span class="w"> </span>*****************************************************************************************************************************
ok:<span class="w"> </span><span class="o">[</span>testhost.sophos.com<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;query_host.api_response.Response.IPHost.IPAddress&quot;</span>:<span class="w"> </span><span class="s2">&quot;2.2.2.2&quot;</span>
<span class="se">\}</span>

PLAY<span class="w"> </span>RECAP<span class="w"> </span>********************************************************************************************************************************************
testhost.sophos.com<span class="w">              </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">2</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>Finally, if we want to delete the IP Host we can set the state to <code class="docutils literal notranslate"><span class="pre">absent</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># playbook.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SOPHOS FIREWALL ANSIBLE PLAYBOOK</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REMOVE IP HOST</span>
<span class="w">      </span><span class="nt">sophos.sophos_firewall.sfos_ip_host</span><span class="p">:</span>
<span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">username</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">password</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">verify</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">verify</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testhost</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>test.yml<span class="w"> </span>--ask-vault-pass<span class="w"> </span>-v
No<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span>found<span class="p">;</span><span class="w"> </span>using<span class="w"> </span>defaults
Vault<span class="w"> </span>password:

PLAY<span class="w"> </span><span class="o">[</span>SOPHOS<span class="w"> </span>FIREWALL<span class="w"> </span>ANSIBLE<span class="w"> </span>PLAYBOOK<span class="o">]</span><span class="w"> </span>*********************************************************************************************************

TASK<span class="w"> </span><span class="o">[</span>REMOVE<span class="w"> </span>IP<span class="w"> </span>HOST<span class="o">]</span><span class="w"> </span>*********************************************************************************************************************************
changed:<span class="w"> </span><span class="o">[</span>testhost.sophos.com<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span><span class="s2">&quot;api_response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;Response&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@APIVersion&quot;</span>:<span class="w"> </span><span class="s2">&quot;2000.2&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IPS_CAT_VER&quot;</span>:<span class="w"> </span><span class="s2">&quot;1&quot;</span>,<span class="w"> </span><span class="s2">&quot;@IS_WIFI6&quot;</span>:<span class="w"> </span><span class="s2">&quot;0&quot;</span>,<span class="w"> </span><span class="s2">&quot;IPHost&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;@transactionid&quot;</span>:<span class="w"> </span><span class="s2">&quot;&quot;</span>,<span class="w"> </span><span class="s2">&quot;Status&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;#text&quot;</span>:<span class="w"> </span><span class="s2">&quot;Configuration applied successfully.&quot;</span>,<span class="w"> </span><span class="s2">&quot;@code&quot;</span>:<span class="w"> </span><span class="s2">&quot;200&quot;</span><span class="o">}}</span>,<span class="w"> </span><span class="s2">&quot;Login&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;Authentication Successful&quot;</span><span class="o">}}}</span>,<span class="w"> </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>true,<span class="w"> </span><span class="s2">&quot;check_mode&quot;</span>:<span class="w"> </span>false<span class="o">}</span>

PLAY<span class="w"> </span>RECAP<span class="w"> </span>********************************************************************************************************************************************
testhost.sophos.com<span class="w">              </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">2</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>Now if we change the <code class="docutils literal notranslate"><span class="pre">state</span></code> argument back to <code class="docutils literal notranslate"><span class="pre">query</span></code>, we should see a “No. of records Zero.” response which confirms the IP Host was deleted.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>test.yml<span class="w"> </span>--ask-vault-pass<span class="w"> </span>-v
No<span class="w"> </span>config<span class="w"> </span>file<span class="w"> </span>found<span class="p">;</span><span class="w"> </span>using<span class="w"> </span>defaults
Vault<span class="w"> </span>password:

PLAY<span class="w"> </span><span class="o">[</span>SOPHOS<span class="w"> </span>FIREWALL<span class="w"> </span>ANSIBLE<span class="w"> </span>PLAYBOOK<span class="o">]</span><span class="w"> </span>*********************************************************************************************************

TASK<span class="w"> </span><span class="o">[</span>QUERY<span class="w"> </span>IP<span class="w"> </span>HOST<span class="o">]</span><span class="w"> </span>**********************************************************************************************************************************
ok:<span class="w"> </span><span class="o">[</span>testhost.sophos.com<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span><span class="s2">&quot;api_response&quot;</span>:<span class="w"> </span><span class="s2">&quot;No. of records Zero.&quot;</span>,<span class="w"> </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,<span class="w"> </span><span class="s2">&quot;check_mode&quot;</span>:<span class="w"> </span>false<span class="o">}</span>

PLAY<span class="w"> </span>RECAP<span class="w"> </span>********************************************************************************************************************************************
testhost.sophos.com<span class="w">              </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p>For more playbook task examples, see the Examples section in each of the individual <a class="reference external" href="../index.html#modules">modules</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the firewall is a member of a group in Central, the changes made by Ansible
will override the settings of the group. The actual configuration on the firewall may then differ from what is displayed
for the same setting in the Central group.</p>
</div>
</section>


           </div>
          </div>
          

<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial2.x.html" class="btn btn-neutral float-left" title="Tutorial v2.x" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../sfos_admin_settings_module.html" class="btn btn-neutral float-right" title="sophos.sophos_firewall.sfos_admin_settings module – Manage Admin and user settings (System &gt; Administration)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Sophos, Ltd..</p>
  </div>

  
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><!-- extra footer elements for Ansible beyond RTD Sphinx Theme -->

</body>
</html>